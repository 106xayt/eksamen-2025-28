From 76a302834395019d6d9da648f3de88445b29c91d Mon Sep 17 00:00:00 2001
From: 106xayt <arstedist@gmail.com>
Date: Tue, 11 Nov 2025 19:26:12 -0800
Subject: [PATCH] Apply Step 1 patch

---
 payload.json                       |   1 +
 sam-comprehend/.aws-sam/build.toml |  12 +++++++++
 sam-comprehend/0001-t.patch        |  42 +++++++++++++++++++++++++++++
 sam-comprehend/change.patch        | Bin 0 -> 2660 bytes
 sam-comprehend/infra.patch         |   0
 sam-comprehend/my_changes.patch    | Bin 0 -> 1822 bytes
 sam-comprehend/template.yaml       |   8 +++++-
 7 files changed, 62 insertions(+), 1 deletion(-)
 create mode 100644 payload.json
 create mode 100644 sam-comprehend/.aws-sam/build.toml
 create mode 100644 sam-comprehend/0001-t.patch
 create mode 100644 sam-comprehend/change.patch
 create mode 100644 sam-comprehend/infra.patch
 create mode 100644 sam-comprehend/my_changes.patch

diff --git a/payload.json b/payload.json
new file mode 100644
index 0000000..bd8c6ea
--- /dev/null
+++ b/payload.json
@@ -0,0 +1 @@
+﻿{"text":"Apple launches new AI features while Microsoft faces security concerns."}
\ No newline at end of file
diff --git a/sam-comprehend/.aws-sam/build.toml b/sam-comprehend/.aws-sam/build.toml
new file mode 100644
index 0000000..95cdbbb
--- /dev/null
+++ b/sam-comprehend/.aws-sam/build.toml
@@ -0,0 +1,12 @@
+# This file is auto generated by SAM CLI build command
+
+[function_build_definitions.c61505fb-0374-4afd-8a46-96ae990a789f]
+codeuri = "C:\\Users\\chmas\\IdeaProjects\\eksamen-2025-28\\sam-comprehend\\sentiment_function"
+runtime = "python3.11"
+architecture = "x86_64"
+handler = "app.lambda_handler"
+manifest_hash = ""
+packagetype = "Zip"
+functions = ["SentimentAnalysisFunction"]
+
+[layer_build_definitions]
diff --git a/sam-comprehend/0001-t.patch b/sam-comprehend/0001-t.patch
new file mode 100644
index 0000000..8366975
--- /dev/null
+++ b/sam-comprehend/0001-t.patch
@@ -0,0 +1,42 @@
+From 89f364dd44040cf29e754440fbe1982438626b0b Mon Sep 17 00:00:00 2001
+From: 106xayt <arstedist@gmail.com>
+Date: Tue, 11 Nov 2025 10:32:09 -0800
+Subject: [PATCH] t
+
+---
+ .github/workflows/terraform-s3.yml | 10 +++++++---
+ infra-s3/test.txt                  |  2 +-
+ 2 files changed, 8 insertions(+), 4 deletions(-)
+
+diff --git a/.github/workflows/terraform-s3.yml b/.github/workflows/terraform-s3.yml
+index 9fe56cb..c513b75 100644
+--- a/.github/workflows/terraform-s3.yml
++++ b/.github/workflows/terraform-s3.yml
+@@ -57,10 +57,14 @@ jobs:
+             -backend-config="key=kandidat-28/infra-s3.tfstate"
+ 
+       # Import er idempotent: første gang state er tom, ellers no-op
+-      - name: Import existing bucket to state (idempotent)
++      - name: Import existing bucket to state (pnly if missing)
+         run: |
+-          terraform state list >/dev/null 2>&1 || true
+-          terraform import -no-color aws_s3_bucket.results "${TF_VAR_bucket_name}" || true
++          set -e
++          if terraform state list | grep -q '^aws_s3_bucket\.results$'; then
++          echo "aws_s3_bucket.results already in state. Skipping import."
++          else
++          terraform import -no-color aws_s3_bucket.results "${TF_VAR_bucket_name}"
++          fi
+ 
+       - name: Terraform Format
+         run: terraform fmt -check
+diff --git a/infra-s3/test.txt b/infra-s3/test.txt
+index a13c399..bf5b197 100644
+--- a/infra-s3/test.txt
++++ b/infra-s3/test.txt
+@@ -1 +1 @@
+-﻿test
++﻿hei
+-- 
+2.45.1.windows.1
+
diff --git a/sam-comprehend/change.patch b/sam-comprehend/change.patch
new file mode 100644
index 0000000000000000000000000000000000000000..a6d30e73c9b8b561ae55a695e5cbdc53959cc6e5
GIT binary patch
literal 2660
zcmchZTW`}q5QXO%35g%TgH;+XDo)cjY10B#kx(UGcz^;gh{`Tb8<LoigkD7X>%ezr
zW5o$+DN=-1w)ZkSbLPzKtbhGHvM<)7wQXdPHEr8kwqcuAw@<V>t>(`W^Xsf;wq*^U
z*GkJ$X4aT*vRY?nlfCOaDXXd7wp;exzM=aBI|JLn#u_V|c5aDXxXq{Z1~#OhVX^JK
zJv#<d!l-Li3mA7@+Y4qTDNSkzXwUe*LjNh>HCnK-1DbW@YM_hg)p#28VtP%Un(Gt7
zpeaJHMtX#!MU!+4mcUM8tDp&^6YQpp&)lyLvR!&-pkH--1AI!DmDfFV3_(-H;~sL6
z?_7i?VQpIu-V8<~k6wnCn{bw5Puw+NWP_377MKzLimZ0aznJ+&`6it!-WKcSp6!7$
z#)mC?>^T%+r5M#&3lg7UJcaEY_pXTSpWhg%1a>+wC;np3vYd#uiSRR9@|6pE9pog@
z=27m&<WZ9-i}#jCxrpwFvGO=%=+YR07@4+zkMT<~q3_wDbC;nfatqmbUOAqlOL^Y1
zyOp<<;*3P#6QW~QCe{iaBXss)NaHR|num;X=3}1zIO=6YihqvI9@4Tmi|rg_vLugX
zH6`~0bHXl*(?}l9_2iLTUO{%!7H_!^#xCbfZ0h`~vJGhgd%!TUU-Slel)LYjbNDHw
z6qD(5J?(ebZHbdz@<V6xly8o1MM5=b*Y10Ly0lBiBebb{g>zU~DSzi#Y>zW!z<!;G
z5LwkoRUqY2;&tc{uQ%*)Dq2<6Gv<Y8#5W?(m+d=MbRWrg)autWI}XtwGUErb5x8fO
zPe-&sKg3SJ7yO$q6=F2c%W`H<c$MvA_n}WOwy(S&*vD%;{y+_!_Ia5dPuQnBNoOon
ztO9rWn~~+Zx5U!FaGJobY$oJD$iy5S6OXEl-cVQCoW}k*GnKECicrPkb-21{yN=g+
zjF$EP@4UI%7u8#>M&oyx|JmwrfX}n%Z{KrX{|e#uF7FTh$=ROAN(<IQo+{Rgc*l`k
z{Rc2x_rra!=vH~oU7P+4{w^oKB~{$siQm*moZ4-gZts*D*5Iu_tSvawztdH>_s#5;
m@8+BBC~jW;SFL#U(u}aj_GsyS<xWMs%Ks4MFeffUWPbwyG?W<t

literal 0
HcmV?d00001

diff --git a/sam-comprehend/infra.patch b/sam-comprehend/infra.patch
new file mode 100644
index 0000000..e69de29
diff --git a/sam-comprehend/my_changes.patch b/sam-comprehend/my_changes.patch
new file mode 100644
index 0000000000000000000000000000000000000000..5199b8a2f6210d3b7b65fdba678e89689984ddba
GIT binary patch
literal 1822
zcmbuA+iufP5JgAg4T*m+<uOTV+EPlN8Vaotw<rmhw<^u8QQbJQ9YpvIzKRdwH-NS0
z#B!3hDpGXhc#b`nz4y#<{{HFP*oLggYOE2v9J^~zE#vo^XFW@}Pc5~9U2;vV&)XbJ
zPh-4fZ`<7cW1=rMh<;=b!Jrxg`%bQ1tJ?v)3#>h=Y-0`W&|a|Lv3)%1+;{NVXDM1d
zY8!G;o{F!{*&N$3XlnM{s$i{SR~GgGc6fV+jtR`V+%r3J9uaTD>Y&IqdL%YO>m#1-
z!B`jzkI3G8KN7k$w>JJi*voU*o}taEZ;Lz=GKH-2ni7@M-Gt{-SvZ3Rs?gy5*t3=O
z?zf&0`SZbV`^9~1SF8b+Dyz3C_NniBjzpEqipu`lJ*QyOJmhxb=!Wb@#HBuWV}B+F
zE&R{yjeWEa;C;82t3ibL1!XJvm+KX1hGd(eeNJrfl#)Tk)R{Nz3%Z_Dp@G(`NR_Jr
ztG?Zzs{>*&N$GQwU)7GC(<Rl#L|8Nh1FsS-ew#cMXU&1mo8p(}q)p#mg1zTD=co{T
zmwkk@L#L<2t5TaxVmU!kG193CYn4ZskP*I`yE=YCS5A<u8tnBY=&osVGt(75nt|~m
zqQ;CKuEiHPB3Cqnm2ghUUv^xKbvjGV(oV`o;LF_#+_YcEt8d(dD@KoutQk@2Mz)xP
zY(@Q+ztQ<i!6L7qYjL*qZK`t4bhgE&$_X#d_Fb_hM_HQoZ{SG5J@GC})%ETbF`q#$
zMY`~hm+%ztSMO5loay+)<h`X*$GiWSGo$I#9Na!TH>bSF8!|Ti)SYrBzIw(jaI33A
zlzOk!<q`h|TMIRdc-@;Y)#UfMN=27Ff~~1ky%TcI$X>?H@6@Nra{Gyh?Ekp`11f6@
A!2kdN

literal 0
HcmV?d00001

diff --git a/sam-comprehend/template.yaml b/sam-comprehend/template.yaml
index 216db23..bf89204 100644
--- a/sam-comprehend/template.yaml
+++ b/sam-comprehend/template.yaml
@@ -7,11 +7,16 @@ Globals:
     Timeout: 30
     MemorySize: 256
     Runtime: python3.11
+  Api:                       # ← ikke under Function
+    EndpointConfiguration: REGIONAL
+    Auth:
+      DefaultAuthorizer: AWS_IAM
+      AddDefaultAuthorizerToCorsPreflight: false
 
 Parameters:
   S3BucketName:
     Type: String
-    Default: pgr301-sentiment-data
+    Default: kandidat-28-data
     Description: S3 bucket for storing sentiment analysis results
 
 Resources:
@@ -23,6 +28,7 @@ Resources:
       Environment:
         Variables:
           S3_BUCKET: !Ref S3BucketName
+          S3_PREFIX: "midlertidig/"
       Policies:
         - S3CrudPolicy:
             BucketName: !Ref S3BucketName
-- 
2.45.1.windows.1

